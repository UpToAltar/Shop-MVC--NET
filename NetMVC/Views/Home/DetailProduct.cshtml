
@model NetMVC.Models.Main.IndexDetail
@{
    ViewData["Title"] = "Detail Product";
}
<head>
    <link rel="stylesheet" type="text/css" href="~/Assets/Main/styles/single_styles.css">
    <link rel="stylesheet" type="text/css" href="~/Assets/Main/styles/single_responsive.css">
</head>
<div class="container single_product_container">
		<div class="row">
			<div class="col">

				<!-- Breadcrumbs -->

				<div class="breadcrumbs d-flex flex-row align-items-center">
					<ul>
						<li><a asp-area="" asp-controller="Home" asp-action="Index">Home</a></li>
						<li><a  asp-area="" asp-controller="Home" asp-action="Shop"><i class="fa fa-angle-right" aria-hidden="true"></i>@Model.product.ProductCategory.Title</a></li>
						<li class="active"><a href="#"><i class="fa fa-angle-right" aria-hidden="true"></i>@Model.product.Title</a></li>
					</ul>
				</div>

			</div>
		</div>

		<div class="row">
			<div class="col-lg-7">
				<div class="single_product_pics">
					<div class="row">
						<div class="col-lg-3 thumbnails_col order-lg-1 order-2">
							<div class="single_product_thumbnails">
								<ul>
									@if (@Model.product != null)
									{
										<li class="active"><img src="@Model.product.Image" alt="" data-image="@Model.product.Image"></li>
										foreach (var image in Model.product.ProductImages)
										{
											<li><img src="@image.Image" alt="" data-image="@image.Image"></li>
										}
									}
									else
									{
										<li><img src="~/Assets/Main/images/single_1_thumb.jpg" alt="" data-image="/Assets/Main/images/single_1.jpg"></li>
										<li class="active"><img src="~/Assets/Main/images/single_2_thumb.jpg" alt="" data-image="/Assets/Main/images/single_2.jpg"></li>
										<li><img src="~/Assets/Main/images/single_3_thumb.jpg" alt="" data-image="/Assets/Main/images/single_3.jpg"></li>
									}
								</ul>
							</div>
						</div>
						<div class="col-lg-9 image_col order-lg-2 order-1">
							<div class="single_product_image">
								@if (Model.product.Image != null)
								{
									<div class="single_product_image_background" style="background-image:url(@Model.product.Image)"></div>
								}
								else
								{
									<div class="single_product_image_background" style="background-image:url('/Assets/Main/images/single_2.jpg')"></div>
								}
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="col-lg-5">
				<div class="product_details">
					@if (Model.product != null)
					{
						<div class="product_details_title">
							<h2>@Model.product.Title</h2>
							<p>@Model.product.Description</p>
						</div>
						<div class="free_delivery d-flex flex-row align-items-center justify-content-center" style="margin-bottom: 20px">
							<span class="ti-truck"></span><span>free delivery</span>
						</div>
						if (Model.product.IsSale)
						{
							<div class="original_price">$@Model.product.Price.ToString()</div>
							<div class="product_price">$@Model.product.PriceSale.ToString()</div>
						}
						else
						{
							<div class="product_price">$@Model.product.Price.ToString()</div>
						}
						
						<ul class="star_rating">
							<li><i class="fa fa-star" aria-hidden="true"></i></li>
							<li><i class="fa fa-star" aria-hidden="true"></i></li>
							<li><i class="fa fa-star" aria-hidden="true"></i></li>
							<li><i class="fa fa-star" aria-hidden="true"></i></li>
							<li><i class="fa fa-star-o" aria-hidden="true"></i></li>
						</ul>
						<div class="mt-3">
							<span>In stock : <strong>@Model.product.Quantity</strong></span>
						</div>
						<div class="mt-3">
							<span>View Count : <strong>@Model.product.ViewCount</strong></span>
						</div>
						<div class="quantity d-flex flex-column flex-sm-row align-items-sm-center">
							<span>Quantity:</span>
							<div class="quantity_selector">
								<span class="minus"><i class="fa fa-minus" aria-hidden="true"></i></span>
								<span id="quantity_value">1</span>
								<span class="plus"><i class="fa fa-plus" aria-hidden="true"></i></span>
							</div>
							<div class="red_button add_to_cart_button"><a style="color: #fff;cursor: pointer" class="add_to_cart_btn" data-quantity="1" data-id="@Model.product.Id.ToString()">add to cart</a></div>
							<div class="product_favorite d-flex flex-column align-items-center justify-content-center"></div>
						</div>
					}
					else
					{
						<div class="product_details_title">
							<h2>Pocket cotton sweatshirt</h2>
							<p>Nam tempus turpis at metus scelerisque placerat nulla deumantos solicitud felis. Pellentesque diam dolor, elementum etos lobortis des mollis ut...</p>
						</div>
						<div class="free_delivery d-flex flex-row align-items-center justify-content-center">
							<span class="ti-truck"></span><span>free delivery</span>
						</div>
						<div class="original_price">$629.99</div>
						<div class="product_price">$495.00</div>
						<ul class="star_rating">
							<li><i class="fa fa-star" aria-hidden="true"></i></li>
							<li><i class="fa fa-star" aria-hidden="true"></i></li>
							<li><i class="fa fa-star" aria-hidden="true"></i></li>
							<li><i class="fa fa-star" aria-hidden="true"></i></li>
							<li><i class="fa fa-star-o" aria-hidden="true"></i></li>
						</ul>
						<div class="product_color">
							<span>Select Color:</span>
							<ul>
								<li style="background: #e54e5d"></li>
								<li style="background: #252525"></li>
								<li style="background: #60b3f3"></li>
							</ul>
						</div>
						<div class="quantity d-flex flex-column flex-sm-row align-items-sm-center">
							<span>Quantity:</span>
							<div class="quantity_selector">
								<span class="minus"><i class="fa fa-minus" aria-hidden="true"></i></span>
								<span id="quantity_value">1</span>
								<span class="plus"><i class="fa fa-plus" aria-hidden="true"></i></span>
							</div>
							<div class="red_button add_to_cart_button"><a href="#">add to cart</a></div>
							<div class="product_favorite d-flex flex-column align-items-center justify-content-center"></div>
						</div>
					}
				</div>
			</div>
		</div>

	</div>

	<!-- Tabs -->

	<div class="tabs_section_container">

		<div class="container">
			<div class="row">
				<div class="col">
					<div class="tabs_container">
						<ul class="tabs d-flex flex-sm-row flex-column align-items-left align-items-md-center justify-content-center">
							<li class="tab active" data-active-tab="tab_1"><span>Description</span></li>
							<li class="tab" data-active-tab="tab_2"><span>Reviews (@Model.product.Comments.Count.ToString())</span></li>
						</ul>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="col">

					<!-- Tab Description -->

					@if (Model.product != null)
					{
						<div id="tab_1" class="tab_container active">
							<div class="row">
								<div class="col">
									<div class="tab_title">
										<h4>Description</h4>
									</div>
									@Html.Raw(@Model.product.Detail)
								</div>
							</div>
						</div>
					}
					else
					{
						<div id="tab_1" class="tab_container active">
							<div class="row">
								<div class="col-lg-5 desc_col">
									<div class="tab_title">
										<h4>Description</h4>
									</div>
									<div class="tab_text_block">
										<h2>Pocket cotton sweatshirt</h2>
										<p>Nam tempus turpis at metus scelerisque placerat nulla deumantos solicitud felis. Pellentesque diam dolor, elementum etos lobortis des mollis ut...</p>
									</div>
									<div class="tab_image">
										<img src="~/Assets/Main/images/desc_1.jpg" alt="">
									</div>
									<div class="tab_text_block">
										<h2>Pocket cotton sweatshirt</h2>
										<p>Nam tempus turpis at metus scelerisque placerat nulla deumantos solicitud felis. Pellentesque diam dolor, elementum etos lobortis des mollis ut...</p>
									</div>
								</div>
								<div class="col-lg-5 offset-lg-2 desc_col">
									<div class="tab_image">
										<img src="~/Assets/Main/images/desc_2.jpg" alt="">
									</div>
									<div class="tab_text_block">
										<h2>Pocket cotton sweatshirt</h2>
										<p>Nam tempus turpis at metus scelerisque placerat nulla deumantos solicitud felis. Pellentesque diam dolor, elementum etos lobortis des mollis ut...</p>
									</div>
									<div class="tab_image desc_last">
										<img src="~/Assets/Main/images/desc_3.jpg" alt="">
									</div>
								</div>
							</div>
						</div>
					}

					<!-- Tab Additional Info -->

					<div id="tab_2" class="tab_container">
						<div class="row">
							<!-- User Reviews -->
                            
							<div class="col-lg-6 reviews_col">
								<div class="tab_title reviews_title">
									<h4>Reviews (@Model.product.Comments.Count.ToString())</h4>
								</div>
                            
								@if (Model.product != null)
								{
									@foreach (var item in Model.product.Comments)
									{
										<!-- User Review -->
                            
										<div class="user_review_container d-flex flex-column flex-sm-row">
											<div class="user">
												<div class="user_pic">
													@if (item.AppUser.Image != null)
													{
														<img style="max-height: 100%;max-width: 100%" src="@item.AppUser.Image" alt="">
													}
												</div>
												<div class="user_rating">
													<ul class="star_rating">
														@for (int i = 1; i <= item.Rating; i++)
														{
															<li><i class="fa fa-star" aria-hidden="true"></i></li>
														}
														@for (int i = 1; i <= 5 - item.Rating; i++)
														{
															<li><i class="fa fa-star-o" aria-hidden="true"></i></li>
														}
													</ul>
												</div>
											</div>
											<div class="review">
												@{
													DateTime dateTime = DateTime.Parse(@item.CreatedAt.ToString());
												}
												<div class="review_date">@dateTime.Day.ToString() - @dateTime.Month.ToString() - @dateTime.Year.ToString()</div>
												<div class="user_name">@item.AppUser.UserName</div>
												<p>@item.Content</p>
											</div>
										</div>
									}
								}
								else
								{
									<!-- User Review -->
                            
									<div class="user_review_container d-flex flex-column flex-sm-row">
										<div class="user">
											<div class="user_pic"></div>
											<div class="user_rating">
												<ul class="star_rating">
													<li><i class="fa fa-star" aria-hidden="true"></i></li>
													<li><i class="fa fa-star" aria-hidden="true"></i></li>
													<li><i class="fa fa-star" aria-hidden="true"></i></li>
													<li><i class="fa fa-star" aria-hidden="true"></i></li>
													<li><i class="fa fa-star-o" aria-hidden="true"></i></li>
												</ul>
											</div>
										</div>
										<div class="review">
											<div class="review_date">27 Aug 2016</div>
											<div class="user_name">Brandon William</div>
											<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
										</div>
									</div>
                            
									<!-- User Review -->
                            
									<div class="user_review_container d-flex flex-column flex-sm-row">
										<div class="user">
											<div class="user_pic"></div>
											<div class="user_rating">
												<ul class="star_rating">
													<li><i class="fa fa-star" aria-hidden="true"></i></li>
													<li><i class="fa fa-star" aria-hidden="true"></i></li>
													<li><i class="fa fa-star" aria-hidden="true"></i></li>
													<li><i class="fa fa-star" aria-hidden="true"></i></li>
													<li><i class="fa fa-star-o" aria-hidden="true"></i></li>
												</ul>
											</div>
										</div>
										<div class="review">
											<div class="review_date">27 Aug 2016</div>
											<div class="user_name">Brandon William</div>
											<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
										</div>
									</div>
								}
							</div>
							<!-- Add Review -->
                                                    
							<div class="col-lg-6 add_review_col">
								<div class="add_review">
									<form class="form-comment" id="review_form" method="post">
										<div>
											<input name="ProductId" value="@Model.product.Id" hidden="hidden"/>
											<input name="AppUserId" value="@Model.userId" hidden="hidden"/>
										</div>
										<div>
											<h1>Your Rating:</h1>
											<ul class="user_star_rating">
												<li><i class="fa fa-star" aria-hidden="true"></i></li>
												<li><i class="fa fa-star" aria-hidden="true"></i></li>
												<li><i class="fa fa-star" aria-hidden="true"></i></li>
												<li><i class="fa fa-star" aria-hidden="true"></i></li>
												<li><i class="fa fa-star-o" aria-hidden="true"></i></li>
											</ul>
											<textarea id="review_message" class="input_review" name="Content"  placeholder="Your Review" rows="4" required data-error="Please, leave us a review."></textarea>
										</div>
										<div class="text-left text-sm-right">
											<button id="review_submit" type="submit" class="red_button review_submit_btn trans_300" value="Submit">submit</button>
										</div>
									</form>
								</div>
                                                    
							</div>
							
						</div>
					</div>

				</div>
			</div>
		</div>

	</div>

<partial name="~/Views/Main/_Policy.cshtml" model="@Model.policyModel" />
<script>
async function postData(url = "", data = {}) {
    // Default options are marked with *
    const response = await fetch(url, {
        method: "POST", // *GET, POST, PUT, DELETE, etc.
        headers: {
            "Content-Type": "application/json",
         
            // 'Content-Type': 'application/x-www-form-urlencoded',
        },
        

        body: JSON.stringify(data), // body data type must match "Content-Type" header
    });
    return response.json(); // parses JSON response into native JavaScript objects
}
 async function Comment (){
    	
      const form = document.querySelector(".form-comment");
      form.addEventListener("submit", async function (event) {
        event.preventDefault();  
        const formData = new FormData(form);
        const data = {};
		let star = 0;
		const starList = document.querySelectorAll(".user_star_rating li");
		starList.forEach((starItem) => {
			if (starItem.querySelector("i").classList.contains("fa-star")){
				star += 1;
			}
		});
        formData.forEach((value, key) => {
            data[key] = value;
        });
		data["Rating"] = star;
	
		if (data["__RequestVerificationToken"]){
			delete data["__RequestVerificationToken"];
		}
		if (data["AppUserId"] == ""){
			alert("Please login to comment");
			window.location.href = "/Identity/Account/Login";
		}
			
		
		const result = await postData("/Comment/Home/Create", data);
		alert(result.message);
		window.location.reload();		
		}
					
	  );
}
Comment();
</script>


